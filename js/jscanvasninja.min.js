this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(){},b=a.prototype;b.success=function(){},b.failure=function(){},jsCanvasNinja.Callback=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(){this.initialize()},b=a.prototype;b.initialize=function(){this.executeTasks=[],this.unexecuteTasks=[]},b.addExecuteTasks=function(a){for(var b=0;b<a.length;b++)this.addExecuteTask(a[b])},b.addExecuteTask=function(a){this.executeTasks.push(a)},b.execute=function(){for(var a=0;a<this.executeTasks.length;a++)this.executeTasks[a]},b.addUnexecuteTasks=function(a){for(var b=0;b<a.length;b++)this.addUnexecuteTask(a[b])},b.addUnexecuteTask=function(a){this.unexecuteTasks.push(a)},b.unexecute=function(){for(var a=0;a<this.unexecuteTasks.length;a++)this.unexecuteTasks[a]},jsCanvasNinja.Command=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(){this.initialize()},b=a.prototype;b.initialize=function(){this.didCommands=[],this.undidCommands=[]},b.canUndo=function(){return Boolean(this.didCommands.length>0)},b.canRedo=function(){return Boolean(this.undidCommands.length>0)},b.push=function(a){this.didCommands.push(a),this.undidCommands=[]},b.undo=function(){if(this.canUndo()){var a=this.didCommands.pop();this.undidCommands.push(a),"function"==typeof a.unexecute&&a.unexecute()}},b.redo=function(){if(this.canUndo()){var a=this.undidCommands.pop();this.didCommands.push(a),"function"==typeof a.execute&&a.execute()}},jsCanvasNinja.CommandManager=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(){throw"Utility cannot be instantiated"};a._CENTER=1,a.isText=function(a){return a?a.hasOwnProperty("text"):!1},a.hasColor=function(a){return a?a.hasOwnProperty("color"):!1},a.hasHeight=function(a){return a?a.hasOwnProperty("height")&&!isNaN(a.height):void 0},a.hasWidth=function(a){return a?a.hasOwnProperty("width")&&!isNaN(a.width):void 0},a.isCentralCoordinate=function(a){return a?a.hasOwnProperty("_type")&&Boolean(this._CENTER&a._type):!1},jsCanvasNinja.Utility=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(){throw"Transform cannot be instantiated"};a.rotate=function(a){if(!jsCanvasNinja.Utility.isCentralCoordinate(this)){var b=new createjs.Matrix2D,c=new createjs.Matrix2D;b.translate(.5*this.width*this.scaleX,.5*this.height*this.scaleY),b.rotate(this.rotation*Math.PI/180),c.translate(-b.tx,-b.ty),c.rotate((a-this.rotation)*Math.PI/180),this.x+=Math.round(c.tx+b.tx),this.y+=Math.round(c.ty+b.ty)}this.rotation=a},a.scale=function(a,b){if(a=null===a||void 0===a?this.scaleX:a,b=null===b||void 0===b?this.scaleX:a,!jsCanvasNinja.Utility.isCentralCoordinate(this)){var c=new createjs.Matrix2D,d=new createjs.Matrix2D;c.translate(this.width*this.scaleX*.5,this.height*this.scaleY*.5),c.rotate(this.rotation*Math.PI/180),c.translate(this.x,this.y),d.translate(-this.width*a*.5,-this.height*b*.5),d.rotate(this.rotation*Math.PI/180),d.translate(c.tx,c.ty),this.x=d.tx,this.y=d.ty}this.scaleX=a,this.scaleY=b},jsCanvasNinja.Transform=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new createjs.Bitmap;b.Bitmap_initalize=b.initialize,b.initialize=function(a,b,c){this.Bitmap_initalize(a),b=isNaN(b)?0:b,c=isNaN(c)?0:c,this.width=a.width,this.height=a.height,this.x=b-.5*this.width,this.y=c-.5*this.height,this._type=0},b.clone=function(){var b=new a(this.image,this.x,this.y,this.width,this.height);return this.sourceRect&&(b.sourceRect=this.sourceRect.clone()),this.cloneProps(b),b},jsCanvasNinja.Bitmap=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new createjs.Text;b.Text_initalize=b.initialize,b.initialize=function(a,b,c,d,e){this.Text_initalize(a,b,c),d=isNaN(d)?0:d,e=isNaN(e)?0:e;var f=(this.lineWidth||this.getMeasuredWidth())*this.getMeasuredLineHeight()/this.getMeasuredHeight(),g=this.getMeasuredHeight();this.width=f,this.height=g,this.x=d-.5*f,this.y=e-.5*g,this._type=0,this.hitArea=new createjs.Shape,this.hitArea.graphics.beginFill("#000").drawRect(0,0,this.width,this.height).endFill()},b.clone=function(){var b=new a(this.text,this.font,this.color,this.x,this.y);return this.cloneProps(b),b},b.setColor=function(a){this.color=a},b.getColor=function(){return this.color},b.setText=function(a){this.text=a,this.width=(this.lineWidth||this.getMeasuredWidth())*this.getMeasuredLineHeight()/this.getMeasuredHeight(),this.height=this.getMeasuredHeight()},b.getText=function(){return this.text},jsCanvasNinja.Text=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new createjs.Shape;b.Shape_initialize=b.initialize,b.initialize=function(a,b,c,d,e){a=isNaN(a)?0:a,b=isNaN(b)?0:b,e=e||"rgba(255, 255, 255, 1)",this.width=c,this.height=d,this.x=a,this.y=b,this.toX=c,this.toY=d,this.color=e,this._type=0,this.graphics=(new createjs.Graphics).beginStroke(this.color).moveTo(0,0).lineTo(this.toX,this.toY).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.toX,this.toY,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginStroke(this.color).moveTo(0,0).lineTo(this.toX,this.toY).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.Line=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d){this.initialize(a,b,c,d)},b=a.prototype=new createjs.Shape;b.initialize=function(a,b,c,d){a=isNaN(a)?0:a,b=isNaN(b)?0:b,c=isNaN(c)?0:c,d=d||"rgba(255, 255, 255, 1)",this.width=2*c,this.height=2*c,this.x=a,this.y=b,this.color=d,this._type=jsCanvasNinja.Utility._CENTER,this.radius=c,this.graphics=(new createjs.Graphics).beginFill(this.color).drawCircle(0,0,this.radius).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.radius,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginFill(this.color).drawCircle(0,0,this.radius).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.Circle=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new createjs.Shape;b.initialize=function(a,b,c,d,e){a=isNaN(a)?0:a,b=isNaN(b)?0:b,c=isNaN(c)?0:c,d=isNaN(d)?0:d,e=e||"rgba(255, 255, 255, 1)",this.width=c,this.height=d,this.x=a,this.y=b,this.side=c,this.color=e,this._type=jsCanvasNinja.Utility._CENTER,this.graphics=(new createjs.Graphics).beginFill(this.color).moveTo(0,.5*-this.height).lineTo(.5*this.side,.5*this.height).lineTo(.5*-this.side,.5*this.height).lineTo(0,.5*-this.height).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.side,this.height,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginFill(this.color).moveTo(0,.5*-this.height).lineTo(.5*this.side,.5*this.height).lineTo(.5*-this.side,.5*this.height).lineTo(0,.5*-this.height).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.Triangle=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new createjs.Shape;b.initialize=function(a,b,c,d,e){a=isNaN(a)?0:a,b=isNaN(b)?0:b,e=e||"rgba(255, 255, 255, 1)",this.width=c,this.height=d,this.x=a-.5*this.width,this.y=b-.5*this.height,this.color=e,this._type=0,this.graphics=(new createjs.Graphics).beginFill(this.color).drawRect(0,0,this.width,this.height).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.width,this.height,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginFill(this.color).drawRect(0,0,this.width,this.height).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.Rect=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new createjs.Shape;b.initialize=function(a,b,c,d,e){a=isNaN(a)?0:a,b=isNaN(b)?0:b,c=isNaN(c)?0:c,d=isNaN(d)?0:d,e=e||"rgba(255, 255, 255, 1)",this.width=c,this.height=d,this.x=a-.5*this.width,this.y=b-.5*this.height,this.color=e,this._type=0,this.graphics=(new createjs.Graphics).beginFill(this.color).drawEllipse(0,0,this.width,this.height).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.width,this.height,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginFill(this.color).drawEllipse(0,0,this.width,this.height).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.Ellipse=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e,f,g){this.initialize(a,b,c,d,e,f,g)},b=a.prototype=new createjs.Shape;b.initialize=function(a,b,c,d,e,f,g){a=isNaN(a)?0:a,b=isNaN(b)?0:b,c=isNaN(c)?0:c,g=g||"rgba(255, 255, 255, 1)",this.width=2*c,this.height=2*c,this.x=a,this.y=b,this.radius=c,this.sides=d,this.pointSize=e,this.angle=f,this.color=g,this._type=jsCanvasNinja.Utility._CENTER,this.graphics=(new createjs.Graphics).beginFill(this.color).drawPolyStar(0,0,this.radius,this.sides,this.pointSize,this.angle).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.radius,this.sides,this.pointSize,this.angle,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginFill(this.color).drawPolyStar(0,0,this.radius,this.sides,this.pointSize,this.angle).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.PolyStar=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b,c,d,e,f){this.initialize(a,b,c,d,e,f)},b=a.prototype=new createjs.Shape;b.initialize=function(a,b,c,d,e,f){a=isNaN(a)?0:a,b=isNaN(b)?0:b,f=f||"rgba(255, 255, 255, 1)",this.width=c,this.height=d,this.x=a-.5*this.width,this.y=b-.5*this.height,this.radius=e,this.color=f,this._type=0,this.graphics=(new createjs.Graphics).beginFill(this.color).drawRoundRect(0,0,this.width,this.height,this.radius).endFill()},b.clone=function(){var b=new a(this.x,this.y,this.width,this.height,this.radius,this.color);return this.cloneProps(b),b},b.setColor=function(a){this.color=a,this.graphics.clear().beginFill(this.color).drawRoundRect(0,0,this.width,this.height,this.radius).endFill()},b.getColor=function(){return this.color},jsCanvasNinja.RoundRect=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b){this.initialize(a,b)},b=a.prototype;b.initialize=function(a,b){this._options=b||{},this._elements=[];for(var c=(this._options.color||"rgba(125, 125, 125, 0.6)",this._options.radius||10),d=["TOP_LEFT_HANDLE_FOR_ROTATION","TOP_RIGHT_HANDLE_FOR_ROTATION","BOTTOM_RIGHT_HANDLE_FOR_ROTATION","BOTTOM_LEFT_HANDLE_FOR_ROTATION"],e=0;e<d.length;e++){var f=d[e],g=new jsCanvasNinja.Circle(0,0,c+5,"rgba(255, 0, 0, 1)");g.name=f,this._elements.push(g)}for(var h=a?["TOP_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE","TOP_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE","BOTTOM_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE","BOTTOM_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE"]:["TOP_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE","TOP_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE","BOTTOM_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE","BOTTOM_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE"],e=0;e<h.length;e++){var f=h[e],g=new jsCanvasNinja.Circle(0,0,c,"rgba(255, 255, 255, 1)");g.name=f,this._elements.push(g)}},b.isElement=function(a){for(var b=this.getElements(),c=0;c<b.length;c++){var d=b[c];if(d.id===a.id)return!0}return!1},b.exists=function(){return this._elements.length>0},b.update=function(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b],d=c.name,e=new createjs.Matrix2D;switch(jsCanvasNinja.Utility.isCentralCoordinate(this)){case!0:switch(d){case"TOP_LEFT_HANDLE_FOR_ROTATION":case"TOP_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"TOP_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(.5*-this.width*this.scaleX,.5*-this.height*this.scaleY),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0);break;case"TOP_RIGHT_HANDLE_FOR_ROTATION":case"TOP_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"TOP_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(.5*this.width*this.scaleX,.5*-this.height*this.scaleY),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0);break;case"BOTTOM_RIGHT_HANDLE_FOR_ROTATION":case"BOTTOM_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"BOTTOM_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(.5*this.width*this.scaleX,.5*this.height*this.scaleY),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0);break;case"BOTTOM_LEFT_HANDLE_FOR_ROTATION":case"BOTTOM_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"BOTTOM_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(.5*-this.width*this.scaleX,.5*this.height*this.scaleY),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0)}break;case!1:switch(d){case"TOP_LEFT_HANDLE_FOR_ROTATION":case"TOP_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"TOP_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.appendTransform(this.x,this.y,1,1,0,0,0,0,0);break;case"TOP_RIGHT_HANDLE_FOR_ROTATION":case"TOP_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"TOP_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(this.width*this.scaleX,0),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0);break;case"BOTTOM_RIGHT_HANDLE_FOR_ROTATION":case"BOTTOM_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"BOTTOM_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(this.width*this.scaleX,this.height*this.scaleY),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0);break;case"BOTTOM_LEFT_HANDLE_FOR_ROTATION":case"BOTTOM_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":case"BOTTOM_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":e.translate(0,this.height*this.scaleY),e.rotate(this.rotation*Math.PI/180),e.prependTransform(this.x,this.y,1,1,0,0,0,0,0)}}e.decompose(c)}},b.getElements=function(){return this._elements},jsCanvasNinja.Frame=a}(),this.jsCanvasNinja=this.jsCanvasNinja||{},function(){var a=function(a,b){this.initialize(a,b)},b=a.prototype=new createjs.Stage;b.MODES_MAP=["select","insert"],b._buffers=[],b.Stage_initialize=b.initialize,b.initialize=function(a,b){this.Stage_initialize(a),this._options=b||{},this.setMode(this._options.mode),this.setScaleType(Boolean(this._options.scaleType)),this.didCommands=[],this.undidCommands=[],this._target=null,this._frame=this._options.frame?this._options.frame:new jsCanvasNinja.Frame},b.Stage_toDataURL=b.toDataURL,b.toDataURL=function(a,b){"function"==typeof this.beforeToDataURL&&this.beforeToDataURL();var c=this.Stage_toDataURL(a,b);return"function"==typeof this.afterToDataURL&&this.afterToDataURL(),c},b._createHistory=function(){this.push(function(a){for(var b=[],c=0;c<a.getNumChildren();c++){var d=a.getChildAt(c);a._frame&&a._frame.isElement(d)||b.push(d.clone())}var e=new jsCanvasNinja.Command;return e.children=b,e.execute=function(){a.removeAllChildren();for(var b=0;b<this.children.length;b++){var c=this.children[b].clone();a.bindToframe(a.addChild(c))}},e.unexecute=function(){if(a.removeAllChildren(),a.canUndo())for(var b=0;b<a.didCommands[a.didCommands.length-1].children.length;b++){var c=a.didCommands[a.didCommands.length-1].children[b].clone();a.bindToframe(a.addChild(c))}},e}(this)),"function"==typeof this.onSave&&this.onSave({canUndo:this.canUndo(),canRedo:this.canRedo()})},b.Stage_update=b.update,b.update=function(a){this._updateFrame(),this.Stage_update(),a&&this._createHistory()},b.onMouseDown=function(a){if("insert"===this.getMode())"function"==typeof this.onStageMouseDown&&this.onStageMouseDown(a);else{var b=this.getObjectUnderPoint(a.stageX,a.stageY);!b||this._frame&&this._frame.isElement(b)||(this.setTarget(b),this._createFrame(),"function"==typeof this.onSelect&&this.onSelect(b,a))}},b.setMode=function(a){this.mode=null===a?"select":isNaN(a)?a:this.MODES_MAP[a]},b.getMode=function(){return this.mode},b.setScaleType=function(a){this._scaleType=Boolean(a)},b.getScaleType=function(){return Boolean(this._scaleType)},b.setTarget=function(a){this._target=a},b.getTarget=function(){return this._target},b._removeFrame=function(){if(this._frame){for(var a=this._frame.getElements(),b=0;b<a.length;b++){var c=a[b];this.removeChild(c)}this._frame=null}},b._createFrame=function(){var a=this.getTarget();if(this._removeFrame(),a){var b={rotation:a.rotation,scaleX:a.scaleX,scaleY:a.scaleY};this._frame=new jsCanvasNinja.Frame(this.getScaleType());for(var c=this._frame.getElements(),d=0;d<c.length;d++){var e=c[d];!function(c,d){c.onPress=function(e){var f=c.name,g={x:c.x-e.stageX,y:c.y-e.stageY};e.onMouseMove=function(b){if(jsCanvasNinja.Utility.isCentralCoordinate(a))switch(f){case"TOP_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=(c.tx?-c.tx/Math.abs(c.tx):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.width*2,a.scaleY=(c.ty?-c.ty/Math.abs(c.ty):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.height*2;break;case"TOP_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=-c.tx/a.width*2,a.scaleY=-c.ty/a.height*2;break;case"TOP_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=(c.tx?c.tx/Math.abs(c.tx):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.width*2,a.scaleY=(c.ty?-c.ty/Math.abs(c.ty):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.height*2;break;case"TOP_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=c.tx/a.width*2,a.scaleY=-c.ty/a.height*2;break;case"BOTTOM_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=(c.tx?c.tx/Math.abs(c.tx):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.width*2,a.scaleY=(c.ty?c.ty/Math.abs(c.ty):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.height*2;break;case"BOTTOM_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=c.tx/a.width*2,a.scaleY=c.ty/a.height*2;break;case"BOTTOM_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=(c.tx?-c.tx/Math.abs(c.tx):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.width*2,a.scaleY=(c.ty?c.ty/Math.abs(c.ty):1)*Math.max.apply(null,[Math.abs(c.tx),Math.abs(c.ty)])/a.height*2;break;case"BOTTOM_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=-c.tx/a.width*2,a.scaleY=c.ty/a.height*2;break;case"TOP_LEFT_HANDLE_FOR_ROTATION":case"TOP_RIGHT_HANDLE_FOR_ROTATION":case"BOTTOM_RIGHT_HANDLE_FOR_ROTATION":case"BOTTOM_LEFT_HANDLE_FOR_ROTATION":var e=new createjs.Matrix2D,h=new createjs.Matrix2D;e.translate(f.match(new RegExp("LEFT"))?-a.width*a.scaleX*.5:a.width*a.scaleX*.5,f.match(new RegExp("TOP"))?-a.height*a.scaleY*.5:a.height*a.scaleY*.5),e.rotate(a.rotation*Math.PI/180),h.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),h.rotate(-Math.atan2(e.ty,e.tx)),a.rotation+=180*Math.atan2(h.ty,h.tx)/Math.PI}else switch(f){case"TOP_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D,e=new createjs.Matrix2D;c.translate(a.width*a.scaleX,a.height*a.scaleY),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),e.rotate(-a.rotation*Math.PI/180);var i=Math.max.apply(null,[Math.abs(e.tx)/a.width,Math.abs(e.ty)/a.height]);a.scaleX=-(e.tx?e.tx/Math.abs(e.tx):1)*i,a.scaleY=-(e.ty?e.ty/Math.abs(e.ty):1)*i;var h=new createjs.Matrix2D;h.translate(-a.width*a.scaleX,-a.height*a.scaleY),h.rotate(a.rotation*Math.PI/180),a.x=h.tx+c.tx,a.y=h.ty+c.ty;break;case"TOP_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D,e=new createjs.Matrix2D;c.translate(a.width*a.scaleX,a.height*a.scaleY),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),e.rotate(-a.rotation*Math.PI/180),a.scaleX=-e.tx/a.width,a.scaleY=-e.ty/a.height,a.x=b.stageX+g.x,a.y=b.stageY+g.y;break;case"TOP_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D,e=new createjs.Matrix2D,h=new createjs.Matrix2D;c.translate(0,a.height*a.scaleY),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),e.rotate(-a.rotation*Math.PI/180);var i=Math.max.apply(null,[Math.abs(e.tx)/a.width,Math.abs(e.ty)/a.height]);a.scaleX=(e.tx?e.tx/Math.abs(e.tx):1)*i,a.scaleY=-(e.ty?e.ty/Math.abs(e.ty):1)*i,h.translate(0,-a.height*a.scaleY),h.rotate(a.rotation*Math.PI/180),a.x=h.tx+c.tx,a.y=h.ty+c.ty;break;case"TOP_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D,e=new createjs.Matrix2D,h=new createjs.Matrix2D;c.translate(0,a.height*a.scaleY),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),e.rotate(-a.rotation*Math.PI/180),h.translate(0,e.ty),h.rotate(a.rotation*Math.PI/180),a.scaleX=e.tx/a.width,a.scaleY=-e.ty/a.height,a.x=h.tx+c.tx,a.y=h.ty+c.ty;break;case"BOTTOM_RIGHT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180);var i=Math.max.apply(null,[Math.abs(c.tx)/a.width,Math.abs(c.ty)/a.height]);a.scaleX=(c.tx?c.tx/Math.abs(c.tx):1)*i,a.scaleY=(c.ty?c.ty/Math.abs(c.ty):1)*i;break;case"BOTTOM_RIGHT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D;c.translate(b.stageX+g.x-a.x,b.stageY+g.y-a.y),c.rotate(-a.rotation*Math.PI/180),a.scaleX=c.tx/a.width,a.scaleY=c.ty/a.height;break;case"BOTTOM_LEFT_HANDLE_FOR_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D,e=new createjs.Matrix2D,h=new createjs.Matrix2D;c.translate(a.width*a.scaleX,0),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),e.rotate(-a.rotation*Math.PI/180);var i=Math.max.apply(null,[Math.abs(e.tx)/a.width,Math.abs(e.ty)/a.height]);a.scaleX=-(e.tx?e.tx/Math.abs(e.tx):1)*i,a.scaleY=(e.ty?e.ty/Math.abs(e.ty):1)*i,h.translate(-a.width*a.scaleX,0),h.rotate(a.rotation*Math.PI/180),a.x=h.tx+c.tx,a.y=h.ty+c.ty;break;case"BOTTOM_LEFT_HANDLE_FOR_NON_KEEP_ASPECT_RESIZE":var c=new createjs.Matrix2D,e=new createjs.Matrix2D,h=new createjs.Matrix2D;c.translate(a.width*a.scaleX,0),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),e.rotate(-a.rotation*Math.PI/180),h.translate(e.tx,0),h.rotate(a.rotation*Math.PI/180),a.scaleX=-e.tx/a.width,a.scaleY=e.ty/a.height,a.x=h.tx+c.tx,a.y=h.ty+c.ty;break;case"TOP_LEFT_HANDLE_FOR_ROTATION":case"TOP_RIGHT_HANDLE_FOR_ROTATION":case"BOTTOM_RIGHT_HANDLE_FOR_ROTATION":case"BOTTOM_LEFT_HANDLE_FOR_ROTATION":var c=new createjs.Matrix2D,e=new createjs.Matrix2D,h=new createjs.Matrix2D;c.translate(a.width*a.scaleX*.5,a.height*a.scaleY*.5),c.rotate(a.rotation*Math.PI/180),c.translate(a.x,a.y),e.translate(f.match(new RegExp("LEFT"))?-a.width*a.scaleX*.5:a.width*a.scaleX*.5,f.match(new RegExp("TOP"))?-a.height*a.scaleY*.5:a.height*a.scaleY*.5),e.rotate(a.rotation*Math.PI/180),h.translate(b.stageX+g.x-c.tx,b.stageY+g.y-c.ty),h.rotate(-Math.atan2(e.ty,e.tx));var j=new createjs.Matrix2D,k=new createjs.Matrix2D;j.translate(.5*a.width*a.scaleX,.5*a.height*a.scaleY),j.rotate(a.rotation*Math.PI/180),k.translate(-j.tx,-j.ty),k.rotate(Math.atan2(h.ty,h.tx)),a.x+=Math.round(k.tx+j.tx),a.y+=Math.round(k.ty+j.ty),a.rotation+=180*Math.atan2(h.ty,h.tx)/Math.PI}d._updateFrame()},e.onMouseUp=function(){(b.rotation!==a.rotation||b.scaleX!==a.scaleX||b.scaleY!==a.scaleY)&&d.update(!0)}}}(e,this),this.addChild(e)}this._updateFrame()}},b._updateFrame=function(){this._frame&&this.getTarget()&&this._frame.update.call(this.getTarget(),this._frame.getElements())},b.bindToframe=function(a){return null==a?a:(function(a,b){return a.onPress=function(c){var d=new createjs.Point(a.x,a.y),e={x:d.x-c.stageX,y:d.y-c.stageY};c.onMouseMove=function(c){a.x=c.stageX+e.x,a.y=c.stageY+e.y,"select"===b.getMode()&&b._createFrame()},c.onMouseUp=function(){(d.x!==a.x||d.y!==a.y)&&b.update(!0)}},a}(a,this),void 0)},b.sendBackward=function(a){if(a=a||this.getTarget()){var b=this.getChildIndex(a);if(this.addChildAt(a,b-1),this.getChildIndex(a))return!0}return!1},b.sendToBack=function(a){for(a=a||this.getTarget();this.sendBackward(a););},b.bringForward=function(a){if(a=a||this.getTarget()){var b=this.getChildIndex(a);if(!this._frame.isElement(this.getChildAt(b+1)))return this.addChildAt(a,b+1),!0}return!1},b.bringToFront=function(a){for(a=a||this.getTarget();this.bringForward(a););},b.delete=function(a){a=a||this.getTarget(),a&&(this.removeChild(a),this.setTarget(null),this._removeFrame())},b.deleteAll=function(){this.removeAllChildren()},b.canUndo=function(){return Boolean(this.didCommands.length>0)},b.canRedo=function(){return Boolean(this.undidCommands.length>0)},b.push=function(a){this.didCommands.push(a),this.undidCommands=[]},b.undo=function(){if(this.canUndo()){var a=this.didCommands.pop();this.undidCommands.push(a),"function"==typeof a.unexecute&&a.unexecute(),"function"==typeof this.onUndo&&this.onUndo({canUndo:this.canUndo(),canRedo:this.canRedo()})}},b.redo=function(){if(this.canRedo()){var a=this.undidCommands.pop();this.didCommands.push(a),"function"==typeof a.execute&&a.execute(),"function"==typeof this.onRedo&&this.onRedo({canUndo:this.canUndo(),canRedo:this.canRedo()})}},jsCanvasNinja.Stage=a}();